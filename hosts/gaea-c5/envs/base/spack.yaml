# OLCF Gaea-C5 Spack Environment

spack:
  #############################################################################
  definitions:
  - core_compiler:
    - '%gcc@7.5.0'
  - gcc_compilers:
    - '%gcc@11.2.0'
    - '%gcc@10.3.0'
  - cray_compilers:
    - '%cce@13.0.2'
  - intel_compilers:
    - '%intel@2022.0.2'
  - all_compilers:
    - $gcc_compilers
    - $cray_compilers
    - $intel_compilers
  - core_packages:
    - bazel ^openjdk@11.0:11.99
    - boost
    - ccache
    - cdo@1.9.10+hdf5+netcdf ^hdf5~mpi+cxx+fortran ^fftw~mpi+openmp ^netcdf-c~mpi~parallel-netcdf
    - cdo@1.9.10~szip+aec+hdf5+netcdf ^hdf5~mpi+cxx+fortran ^fftw~mpi+openmp ^netcdf-c~mpi~parallel-netcdf ^eccodes+aec
    - cmake
    - darshan-util
    - emacs +X
    - esmf~mpi~pnetcdf ^netcdf-c~mpi~parallel-netcdf ^hdf5+szip~mpi
    - exuberant-ctags@5.8
    - gdb@10.2
    - git
    - git-lfs
    - glew
    - gnupg
    - gnuplot +X
    - go
    - googletest
    - grib-api
    - gridcf-gct
    - htop
    - imagemagick
    - julia
    - libyaml
    - libzmq
    - mercurial
    - nag
    - nano
    - nccmp ^netcdf-c~mpi~parallel-netcdf ^hdf5~mpi
    - nccmp@1.8.6.5 ^netcdf-c~mpi~parallel-netcdf ^hdf5~mpi
    - nco~mpi~mpi-deps
    - nco@4.7.9~mpi~mpi-deps
    - nedit
    - openblas@0.3.17 threads=none
    - openblas@0.3.17 threads=openmp
    - openblas@0.3.17 threads=pthreads
    - papi~cuda
    - pcre
    - pdt
    - python
    - r
    - screen
    - subversion
    - tkdiff
    - tmux
    - uberftp
    - vim
    - wget
    - wgrib
    - wgrib2 ^netcdf-c~mpi~parallel-netcdf ^hdf5~mpi
  - compute_packages:
    - cdo
    - esmf@8.2.0
    - ferret
    - geos
    - hpctoolkit
    - nccmp
    - ncl
    - nco
    - ncview
  - core_specs:
    - matrix:
      - - $core_packages
      - - $core_compiler
      - - arch=linux-sles15-x86_64
      exclude:
      - julia@1.7.2 # Needs gfortran.so.5
  - compute_specs:
    - matrix:
      - - $compute_packages
      - - "%intel@2022.0.2"
      - - arch=cray-sles15-zen2
  specs:
  - $core_specs
  - darshan-runtime@3.4.0%intel@2022.0.2 arch=cray-sles15-zen2
  - darshan-util@3.4.0%gcc@7.5.0 arch=linux-sles15-x86_64
  # - $compute_specs
  #############################################################################
  mirrors:
    facility_builds: /sw/gaea-c5/spack-env/mirrors/builds
    source_mirror: /sw/sources/facility-spack/source_mirror
  repos:
  - ${FACSPACK_CONF_COMMON}/spack/repos/ncrc
  - ${FACSPACK_CONF_COMMON}/spack/repos/olcf
  #############################################################################
  # Views are managed externally; placing them here triggers a regneration each
  # time the env is re-concretized which both destroys non-spack files (eg
  # symlinks) in "hybrid views" and removes previous builds slated to be
  # re-built from the production view when we want to minimize disruption to
  # users. See $FACSPACK_CONF_ENV/view-generate-*.sh scripts for managing views.
  view: false
  packages:
    all:
      buildable: true
      compiler:
      - gcc@7.5.0
      - gcc
      providers:
        blas:
        - openblas
        - cray-libsci@21.08.1.2
        lapack:
        - openblas
        - cray-libsci@21.08.1.2
        mpi:
        - cray-mpich
        scalapack:
        - netlib-scalapack
      target:
      - zen2
      version: []
    axom:
      variants: ~examples~openmp+hdf5+umpire+raja+mpi
    binutils:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: +libiberty
      version: []
    camp:
      variants: ~rocm
    chai:
      variants: ~examples~benchmarks~tests~rocm
    cray-libsci:
      buildable: false
      externals:
      - modules:
        - cray-libsci/21.08.1.2
        spec: cray-libsci@21.08.1.2
      - modules:
        - cray-libsci/21.06.1.1
        spec: cray-libsci@21.06.1.1
      version:
      - 21.08.1.2
      - 21.06.1.1
    cray-mpich:
      buildable: false
      compiler: []
      externals:
      - modules:
        - cray-mpich/8.1.16
        spec: cray-mpich@8.1.16
      - modules:
        - cray-mpich/8.1.15
        spec: cray-mpich@8.1.15
      providers: {}
      variants: ~wrappers
      target: []
      version:
      - 8.1.16
    darshan-runtime:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: +grouplogs scheduler=slurm logpath="/lustre/f2/darshan"
      version: []
    fftw:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: precision=float,double,long_double
      version: []
    gdbm:
      version:
      - 1.19
    hdf5:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: +hl+cxx+fortran
      version: []
    libfabric:
      buildable: true
      externals:
      - prefix: /opt/cray/libfabric/1.15.0.0
        spec: libfabric@1.15.0.0
      - prefix: /opt/cray/libfabric/1.13.0.0
        spec: libfabric@1.13.0.0
      version:
      - 1.15.0.0
      - 1.13.0.0
      variants: fabrics=rxm,sockets,tcp,udp
    libtool:
      buildable: true
      compiler: []
      providers: {}
      target: []
      version:
      - 2.4.6
    m4:
      buildable: true
      compiler: []
      externals: []
      providers: {}
      target: []
      version:
      - 1.4.18
    mpich:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: +verbs+slurm device=ch4 netmod=ofi pmi=pmi
      version:
      - 3.4.1
    netcdf-c:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: ~hdf4+mpi+parallel-netcdf+shared
      version: []
    netlib-scalapack:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: +fpic
      version: []
    octave:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: +magick+arpack+curl+fftw+fontconfig+freetype+glpk+gnuplot+hdf5+opengl+qhull+qrupdate+qt+readline+suitesparse+zlib
      version: []
    openmpi:
      buildable: false
      compiler: []
      providers: {}
      target: []
      version: []
    openssh:
      buildable: false
      compiler: []
      externals:
      - prefix: /usr
        spec: openssh@8.4
      providers: {}
      target: []
      version:
      - 8.4
    openssl:
      buildable: false
      compiler: []
      externals:
      - spec: openssl@1.1.1-os
        prefix: /usr
      providers: {}
      target: []
      version:
      - 1.1.1-os
    parallel-netcdf:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: +cxx+fortran+fpic
      version: []
    perl:
      externals:
      - spec: perl@5.26.1-os
        prefix: /usr
    petsc:
      variants: +batch
    qt:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: ~ssl
      version: []
    r:
      buildable: true
      compiler: []
      providers: {}
      target: []
      variants: ~X
      version: []
    raja:
      variants: ~exercises~examples~tests~openmp~rocm
    slurm:
      buildable: false
      compiler: []
      externals:
      - prefix: /usr
        spec: slurm@21.08.0
      providers: {}
      target: []
      version:
      - 21.08.0
    sundials:
      variants: ~examples~examples-install
    tcsh:
      buildable: false
      externals:
      - prefix: /usr
        spec: tcsh@6.20.00
      version:
      - 6.20.00
    trilinos:
      variants: +amesos +amesos2 +anasazi +aztec +belos +boost +epetra +epetraext +ifpack +ifpack2 +intrepid +intrepid2 +isorropia +kokkos +ml +minitensor +muelu +nox +piro +phalanx +rol +rythmos +sacado +stk +shards +shylu +stokhos +stratimikos +teko +tempus +tpetra +trilinoscouplings +zoltan +zoltan2 +superlu-dist gotype=long_long
    umpire:
      variants: ~examples~rocm
  modules:
    prefix_inspections:
      bin:
      - PATH
      man:
      - MANPATH
      share/man:
      - MANPATH
      share/aclocal:
      - ACLOCAL_PATH
      lib:
      - LD_LIBRARY_PATH
      lib64:
      - LD_LIBRARY_PATH
      lib/pkgconfig:
      - PKG_CONFIG_PATH
      lib64/pkgconfig:
      - PKG_CONFIG_PATH
      share/pkgconfig:
      - PKG_CONFIG_PATH
      ? ''
      : - CMAKE_PREFIX_PATH
    default:
      roots:
        tcl: ${FACSPACK_ENV_MODULEROOT}/flat
        lmod: ${FACSPACK_ENV_MODULEROOT}/spack
      enable:
      - lmod
      - tcl
      lmod:
        core_compilers:
        - gcc@7.5.0
        all:
          conflict: []
          environment:
            set:
              OLCF_${PACKAGE}_ROOT: ${PREFIX}
            unset: []
          filter:
            environment_blacklist: []
          load: []
          autoload: none
        arpack-ng:
          suffixes:
            arpack-ng ^openblas: openblas
        boost:
          suffixes:
            boost cxxstd=17: cxx17
        cairo:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            cairo+X: X
            cairo+pdf: pdf
        cdo:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            cdo+aec: aec
            cdo^hdf5+mpi^netcdf+mpi^fftw+mpi: parallel
        ferret:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            ferret^hdf5+mpi^netcdf+mpi: parallel
        fftw:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            fftw+openmp: omp
        gromacs:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            gromacs~mpi: analysis
            gromacs~rdtscp: rdtscp_off
        hdf5:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            hdf5~mpi+szip: sz
            hdf5~mpi+threadsafe: threadsafe
        heffte:
          suffixes:
            heffte+fftw: fftw
        kokkos-kernels:
          suffixes:
            kokkos-kernels+openmp: omp
        ncl:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            builtin.ncl ^hdf5+mpi^netcdf+mpi: parallel
        openblas:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            openblas threads=openmp: omp
            openblas threads=pthreads: pthreads
        openmpi:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
        pango:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            pango+X: X
        raja:
          suffixes:
            raja+openmp: omp
        root:
          suffixes:
            ^cray-libsci: cpe
        tau:
          suffixes:
            tau+openmp: omp
        vtk:
          conflict: []
          environment:
            unset: []
          filter:
            environment_blacklist: []
          load: []
          suffixes:
            vtk+mpi: parallel
            vtk+qt: qt
            vtk~mpi: serial
        blacklist_implicits: true
        verbose: true
        whitelist: []
        hash_length: 0
        hierarchy: []
        projections: {}
        core_specs: []
      tcl:
        hash_length: 3
        naming_scheme: '{name}/{version}-{compiler.name}-{compiler.version}'
        blacklist:
        - slurm
        - go-bootstrap
        - openssl
        all:
          conflict:
          - '{name}'
          environment:
            set:
              OLCF_${PACKAGE}_ROOT: ${PREFIX}
            unset: []
          filter:
            environment_blacklist: []
          load: []
        verbose: false
        whitelist: []
        blacklist_implicits: false
        projections: {}
  config:
    install_tree:
      root: ${FACSPACK_ENV}/opt
      projections:
        all: ${ARCHITECTURE}/${COMPILERNAME}-${COMPILERVER}/${PACKAGE}-${VERSION}-${HASH}
    template_dirs:
    - ${FACSPACK_CONF_HOST}/templates
    - ${FACSPACK_CONF_COMMON}/spack/templates
    - $spack/share/spack/templates
    build_stage:
    - $tempdir/$user/spack-stage
    - $spack/var/spack/stage
    source_cache: ${FACSPACK_SOURCE_CACHE}
    extensions:
    - /sw/sources/facility-spack/gaea-c5/share/spack/extensions/spack-olcf
    misc_cache: ${FACSPACK_ENV}/.mcache
    verify_ssl: true
    install_missing_compilers: false
    checksum: true
    dirty: false
    build_language: C
    build_jobs: 24
    ccache: false
    db_lock_timeout: 120
    package_lock_timeout: null
    shared_linking: rpath
    allow_sgid: true
    concretizer: clingo
    locks: true
    suppress_gpg_warnings: false
    connect_timeout: 10
    test_stage: ~/.spack/test
  concretizer:
    unify: false
  compilers:
  - compiler:
      spec: gcc@7.5.0
      paths:
        cc: /usr/bin/gcc
        cxx: /usr/bin/g++
        f77: /usr/bin/gfortran
        fc: /usr/bin/gfortran
      flags: {}
      operating_system: sles15
      target: any
      modules: []
      environment:
        append_path:
          PKG_CONFIG_PATH: /usr/lib64/pkgconfig
      extra_rpaths: []
  - compiler:
      spec: gcc@7-os
      paths:
        cc: /usr/bin/gcc
        cxx: /usr/bin/g++
        f77: /usr/bin/gfortran
        fc: /usr/bin/gfortran
      flags: {}
      operating_system: sles15
      target: any
      modules: []
      environment:
        append_path:
          PKG_CONFIG_PATH: /usr/lib64/pkgconfig
        unset: []
      extra_rpaths: []
  - compiler:
      spec: gcc@10.3.0
      paths:
        cc: /opt/cray/pe/craype/2.7.15/bin/cc
        cxx: /opt/cray/pe/craype/2.7.15/bin/CC
        f77: /opt/cray/pe/craype/2.7.15/bin/ftn
        fc: /opt/cray/pe/craype/2.7.15/bin/ftn
      flags: {}
      operating_system: sles15
      target: any
      modules:
      - PrgEnv-gnu
      - gcc/10.3.0
      - craype-x86-trento
      - libfabric
      environment: {}
      extra_rpaths: []
  - compiler:
      spec: gcc@11.2.0
      paths:
        cc: /opt/cray/pe/craype/2.7.15/bin/cc
        cxx: /opt/cray/pe/craype/2.7.15/bin/CC
        f77: /opt/cray/pe/craype/2.7.15/bin/ftn
        fc: /opt/cray/pe/craype/2.7.15/bin/ftn
      flags: {}
      operating_system: sles15
      target: any
      modules:
      - PrgEnv-gnu
      - gcc/11.2.0
      - craype-x86-rome
      - libfabric
      environment: {}
      extra_rpaths: []
  - compiler:
      spec: cce@13.0.2
      paths:
        cc: /opt/cray/pe/craype/2.7.15/bin/cc
        cxx: /opt/cray/pe/craype/2.7.15/bin/CC
        f77: /opt/cray/pe/craype/2.7.15/bin/ftn
        fc: /opt/cray/pe/craype/2.7.15/bin/ftn
      flags: {}
      operating_system: sles15
      target: any
      modules:
      - PrgEnv-cray
      - cce/13.0.2
      - craype-x86-rome
      - libfabric
      environment: {}
      extra_rpaths:
      - /opt/cray/pe/gcc-libs
      - /opt/cray/gcc-libs
  - compiler:
      spec: intel@2022.0.2
      paths:
        cc: /opt/cray/pe/craype/2.7.15/bin/cc
        cxx: /opt/cray/pe/craype/2.7.15/bin/CC
        f77: /opt/cray/pe/craype/2.7.15/bin/ftn
        fc: /opt/cray/pe/craype/2.7.15/bin/ftn
      flags: {}
      operating_system: sles15
      target: any
      modules:
      - PrgEnv-intel
      - intel/2022.0.2
      - craype-x86-rome
      - libfabric
      environment: {}
      extra_rpaths:
      - /opt/cray/pe/gcc-libs
      - /opt/cray/gcc-libs
