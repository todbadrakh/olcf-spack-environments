# Base environment
# Tuguldur T. Odbadrakh
# 10/13/2023

spack:
  include:
  - config.yaml
  - concretizer.yaml
  - compilers.yaml
  - mirrors.yaml
  - modules.yaml
  - packages.yaml
  - repos.yaml

  definitions:

  - core_compiler:
    - '%gcc@7.5.0'
  - gnu_compilers:
    - '%gcc@12.2.0'
  - cray_compilers:
    - '%cce@16.0.1'
  - amd_compilers:
    - '%rocmcc@5.5.1'

  - core_packages:
    - autoconf
    - autoconf-archive
    - bazel
    - bison
    - bzip2
    - cairo
    - ccache
    - cmake
    - cups
    - exuberant-ctags
    - go
    - googletest cxxstd=17
    - gtkplus
    - htop
    - launchmon cppflags='-std=c++14'
    - libbsd
    - libksba
    - libpng
    - libssh2
    - libx11
    - libzmq +libbsd+libsodium+libunwind
    - mercurial
    - mesa
    - meson
    - ninja
    - openblas
    - openjdk
    - py-jupyterhub
    - py-numpy@1.23.3
    - qt
    - rust
    - sqlite
    - tcl
    - texinfo
    - tmux
    - unzip
    - zlib
    - zstd
  
  - e4s_packages:
    - arpack-ng@3.9.0 ldflags="-ldl" ldlibs="/usr/lib64"
    - boost@1.83.0 +mpi+python+numpy+thread cxxstd=17
    - darshan-runtime@3.3.1 scheduler=slurm
    - darshan-util@3.3.1
    - globalarrays@5.8.2 
    - hdf5@1.14.3 +cxx+fortran
    - kokkos-kernels@4.0.00 +openmp
    - nco@5.0.1
    - netlib-scalapack@2.2.0 
    - parsec@3.0.2209 ~cuda
    - plasma@23.8.2 
    - stat@4.2.1
    - tau@2.33 +mpi+python~pdt # ROCm 4.3.0 is latest in docs so doing non-gpu
    - visit@3.3.3 ~conduit
  - e4s_rocm_packages:
    - adios2@2.9.2 ~python 
    - amrex@22.11 dimensions=3 ^hiprand@5.5.1 ^rocprim@5.5.1 ^rocrand@5.5.1
    - blaspp@2023.08.25 ^openblas
    - hpx@1.9.1
    - hypre@2.29.0 ^rocprim@5.5.1 ^rocrand@5.5.1 ^rocsparse@5.5.1 ^rocthrust@5.5.1
    - kokkos@4.0.00 +openmp
    - lapackpp@2023.08.25 ^rocblas@5.5.1 ^rocsolver@5.5.1
    - magma@2.7.2 ^hipblas@5.5.1 ^hipsparse@5.5.1
    - paraview@5.11.2
    - petsc@3.20.1 ^hipblas@5.5.1 ^hipsolver@5.5.1 ^hipsparse@5.5.1 ^rocblas@5.5.1 ^rocprim@5.5.1 ^rocrand@5.5.1 ^rocsolver@5.5.1
    - slate@2023.08.25
    - superlu-dist@8.1.2 ^hipblas@5.5.1 ^rocsolver@5.5.1
    - upcxx@2023.3.0 +mpi
    - vtk-m@2.0.0

  - core_specs:
    - matrix:
      - - $core_packages
      - - $core_compiler
      - - arch=linux-sles15-x86_64
  - PrgEnv-gnu_specs:
    - matrix:
      - - $e4s_packages
      - - $gnu_compilers
      - - arch=linux-sles15-x86_64
  - PrgEnv-gnu-rocm_specs:
    - matrix:
      - - $e4s_rocm_packages
      - - $gnu_compilers
      - - '+rocm amdgpu_target=gfx908 ^hip@5.5.1 ^hsa-rocr-dev@5.5.1 ^llvm-amdgpu@5.5.1'
      - - arch=linux-sles15-x86_64
  - PrgEnv-amd_specs:
    - matrix:
      - - $e4s_packages
      - - $amd_compilers
      - - arch=linux-sles15-x86_64
  - PrgEnv-amd-rocm_specs:
    - matrix:
      - - $e4s_rocm_packages
      - - $amd_compilers
      - - '+rocm amdgpu_target=gfx908 ^hip@5.5.1 ^hsa-rocr-dev@5.5.1 ^llvm-amdgpu@5.5.1'
      - - arch=linux-sles15-x86_64
  - PrgEnv-cray_specs:
    - matrix:
      - - $e4s_packages
      - - $cray_compilers
      - - arch=linux-sles15-x86_64
      exclude:
      - plasma # cce conflict
  - PrgEnv-cray-rocm_specs:
    - matrix:
      - - $e4s_rocm_packages
      - - $cray_compilers
      - - '+rocm amdgpu_target=gfx908 ^hip@5.5.1 ^hsa-rocr-dev@5.5.1 ^llvm-amdgpu@5.5.1'
      - - arch=linux-sles15-x86_64

  specs:
  - $core_specs
  - $PrgEnv-gnu_specs
  - $PrgEnv-gnu-rocm_specs
  - $PrgEnv-amd_specs
  - $PrgEnv-amd-rocm_specs
  - $PrgEnv-cray_specs
  - $PrgEnv-cray-rocm_specs

  view: false

